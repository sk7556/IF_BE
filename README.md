# Infinity_Travel

-   **Infinity_Travel**ì€ ì‚¬ìš©ìë“¤ì´ ìì‹ ì˜ ì—¬í–‰ ì§€ì—­, í›„ê¸°, ë³„ì ì„ ê³µìœ í•˜ë©° **ìƒˆë¡œìš´ ì—¬í–‰ íŒŒí‹°**ë¥¼ ì°¾ì„ ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.

ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ê³¼ ë§Œë‚¨ì„ í†µí•´ ë§Œë“¤ì–´ì§€ëŠ” ì´ì•¼ê¸°ê°€ ì—¬í–‰ì˜ ëì´ ì–´ë””ì¸ì§€ ì•Œ ìˆ˜ ì—†ëŠ” ë¬´í•œí•œ ì—¬í–‰ì˜ ì‹œì‘ì…ë‹ˆë‹¤.

## í”„ë¡œì íŠ¸ ê¸°ê°„

> 2023.12.08 ~ 2023.12.28

## ğŸ“Œ íŒ€ì› ì†Œê°œ

|                                                                     ê¹€ì°½í™˜ğŸš©                                                                      |                                            ë‚¨ì •ì‹                                            |                                                                      ì‹¬ì£¼ìš©                                                                       |
| :-----------------------------------------------------------------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------------: | :-----------------------------------------------------------------------------------------------------------------------------------------------: |
| <img src="https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/7039dd11-5647-44d8-9a18-d2caea2f5a39" width="200" height="230" > | <img src="https://avatars.githubusercontent.com/u/109896609?v=4"  width="200" height="230"/> | <img src="https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/a7a1ee18-27b9-4d09-846e-ef11b121aa2c" width="200" height="230"/> |
|                                    <a href="https://github.com/Blood-donation-day"> ğŸŒ± Blood-donation-day</a>                                     |                      <a href="https://github.com/sk7556">ğŸŒ± sk7556</a>                       |                                             <a href="https://github.com/SimJuyong1">ğŸŒ± SimJuyong1</a>                                             |

## ëª©ì°¨

[1. í”„ë¡œì íŠ¸ ëª©í‘œ](#1-ëª©í‘œ)<br>
[2. ê°œë°œ í™˜ê²½ ë° ë°°í¬ URL](#2-ê°œë°œ-í™˜ê²½-ë°-ë°°í¬-url)<br>
[3. í”„ë¡œì íŠ¸ êµ¬ì¡°](#3-í”„ë¡œì íŠ¸-êµ¬ì¡°ì™€-ê°œë°œ-ì¼ì •)<br>
[4. êµ¬ì„±ë„ì™€ ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ë§(ERD)](#4-ë°ì´í„°ë² ì´ìŠ¤-ëª¨ë¸ë§erd)<br>
[5. API ëª…ì„¸ì„œ](#5-api-ëª…ì„¸)<br>
[7. ë©”ì¸ê¸°ëŠ¥](#7-ë©”ì¸ê¸°ëŠ¥)<br>
[8. ì¶”ê°€ê¸°ëŠ¥](#7-ì¶”ê°€ê¸°ëŠ¥)<br>
[9. ê°œë°œì¤‘ ê²½í—˜í•œ ë¬¸ì œì ê³¼ í•´ê²°ë°©ë²•](#8-ê°œë°œê³¼ì •ê³¼-ëŠë‚€ì )<br>
[10. í”„ë¡œì íŠ¸ í›„ê¸°](#8-ê°œë°œê³¼ì •ê³¼-ëŠë‚€ì )<br>

## 1. ëª©í‘œ

-   í•¨ê»˜ ì—¬í–‰í•˜ëŠ” íŒŒíŠ¸ë„ˆë¥¼ ëª¨ì§‘í•˜ëŠ” ì„œë¹„ìŠ¤

-   ë‚˜ë§Œì˜ ì¼ì •ì„ ë§Œë“¤ê³  ê³µìœ í•˜ëŠ” ì„œë¹„ìŠ¤

-   ì—¬í–‰ìê°„ ì‹¤ì‹œê°„ ì±„íŒ…ì„ í†µí•´ ì •ë³´ë¥¼ ê³µìœ í•˜ëŠ” ì„œë¹„ìŠ¤

#### FlowChart

<img src=https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/6278f543-6e02-4ec7-b191-df9cf5906a94>

## 2. ê°œë°œ í™˜ê²½ ë° ë°°í¬ URL

#### [FrontEnd]

<div>
    <img src="https://img.shields.io/badge/html5-E34F26?style=for-the-badge&logo=html5&logoColor=white">
    <img src="https://img.shields.io/badge/css3-1572B6?style=for-the-badge&logo=css3&logoColor=white">
    <img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=white">
    <img src="https://img.shields.io/badge/Tailwind-06B6D4?style=for-the-badge&logo=tailwindcss&logoColor=white">
    
</div>

#### [BackEnd]

<div>
    <img src="https://img.shields.io/badge/python-3776AB?style=for-the-badge&logo=python&logoColor=white">
    <img src="https://img.shields.io/badge/django-092E20?style=for-the-badge&logo=django&logoColor=white">
</div>

#### [DataBase]

<img src="https://img.shields.io/badge/postgresql-4169E1?style=for-the-badge&logo=postgresql&logoColor=white">

### 2-2. ë°°í¬ URL

<details>
  <summary> í…ŒìŠ¤íŠ¸ê³„ì •</summary>
  
```
ID: test123@test123.com
PW: test123

ì±„íŒ…í…ŒìŠ¤íŠ¸ 2ë²ˆ ID
ID: test1@test1.com
PW: test123

```

</details>

í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€
https://www.infinity-travel.shop/front/pages/

ë°±ì—”ë“œ
https://www.infinity-travel.shop/

## 3. í”„ë¡œì íŠ¸ êµ¬ì¡°ì™€ ê°œë°œ ì¼ì •

### 3.1í”„ë¡œì íŠ¸ êµ¬ì¡°

```

ğŸ“¦Infinity_Travel_BE
â”£ ğŸ“‚.github
â”ƒ â”— ğŸ“‚workflows
â”ƒ â”ƒ â”— ğŸ“œmain.yml
â”£ ğŸ“‚accounts
â”ƒ â”£ ğŸ“‚migrations
â”ƒ â”£ ğŸ“œadmin.py
â”ƒ â”£ ğŸ“œapps.py
â”ƒ â”£ ğŸ“œmodels.py
â”ƒ â”£ ğŸ“œserializers.py
â”ƒ â”£ ğŸ“œtests.py
â”ƒ â”£ ğŸ“œurls.py
â”ƒ â”£ ğŸ“œutils.py
â”ƒ â”£ ğŸ“œviews.py
â”ƒ â”— ğŸ“œ**init**.py
â”£ ğŸ“‚chat
â”ƒ â”£ ğŸ“‚migrations
â”ƒ â”£ ğŸ“œadmin.py
â”ƒ â”£ ğŸ“œapps.py
â”ƒ â”£ ğŸ“œchatting2.html
â”ƒ â”£ ğŸ“œconsumers.py
â”ƒ â”£ ğŸ“œmodels.py
â”ƒ â”£ ğŸ“œrouting.py
â”ƒ â”£ ğŸ“œserializers.py
â”ƒ â”£ ğŸ“œtests.py
â”ƒ â”£ ğŸ“œurls.py
â”ƒ â”£ ğŸ“œutils.py
â”ƒ â”£ ğŸ“œviews.py
â”ƒ â”— ğŸ“œ**init**.py
â”£ ğŸ“‚companion
â”ƒ â”£ ğŸ“‚migrations
â”ƒ â”£ ğŸ“œadmin.py
â”ƒ â”£ ğŸ“œapps.py
â”ƒ â”£ ğŸ“œmodels.py
â”ƒ â”£ ğŸ“œserializers.py
â”ƒ â”£ ğŸ“œtests.py
â”ƒ â”£ ğŸ“œurls.py
â”ƒ â”£ ğŸ“œviews.py
â”ƒ â”— ğŸ“œ**init**.py
â”£ ğŸ“‚core
â”ƒ â”£ ğŸ“œmodels.py
â”ƒ â”— ğŸ“œpermissions.py
â”£ ğŸ“‚infinity_travel
â”ƒ â”£ ğŸ“œasgi.py
â”ƒ â”£ ğŸ“œsettings.py
â”ƒ â”£ ğŸ“œurls.py
â”ƒ â”£ ğŸ“œwsgi.py
â”ƒ â”— ğŸ“œ**init**.py
â”£ ğŸ“‚place
â”ƒ â”£ ğŸ“‚migrations
â”ƒ â”£ ğŸ“œadmin.py
â”ƒ â”£ ğŸ“œapps.py
â”ƒ â”£ ğŸ“œgeoCode.py
â”ƒ â”£ ğŸ“œmodels.py
â”ƒ â”£ ğŸ“œserializers.py
â”ƒ â”£ ğŸ“œtests.py
â”ƒ â”£ ğŸ“œurls.py
â”ƒ â”£ ğŸ“œviews.py
â”ƒ â”— ğŸ“œ**init**.py
â”£ ğŸ“‚schedule
â”ƒ â”£ ğŸ“‚migrations
â”ƒ â”£ ğŸ“œadmin.py
â”ƒ â”£ ğŸ“œapps.py
â”ƒ â”£ ğŸ“œmodels.py
â”ƒ â”£ ğŸ“œserializers.py
â”ƒ â”£ ğŸ“œtests.py
â”ƒ â”£ ğŸ“œurls.py
â”ƒ â”£ ğŸ“œviews.py
â”ƒ â”— ğŸ“œ**init**.py
â”£ ğŸ“œ.DS_Store
â”£ ğŸ“œ.gitignore
â”£ ğŸ“œmanage.py
â”£ ğŸ“œREADME.md
â”— ğŸ“œrequirements.txt

```

### 3-2 ê°œë°œì¼ì •

[ê°œë°œì¼ì • ë°”ë¡œê°€ê¸°](https://github.com/orgs/Infinity-Scroll/projects/1/views/3)
<img src="https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/281333c3-242b-409e-8490-2595b7d7bc8d" />

## 4.êµ¬ì„±ë„ì™€ ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ë§

### 4-1 ì•„í‚¤í…ì³ êµ¬ì„±ë„

<img src=https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/06172cbc-aa63-44bb-aedb-af65e9d60962>

### 4-2 ë°ì´í„°ë² ì´ìŠ¤-ëª¨ë¸ë§ ERD

<img src="https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/847a351c-0284-4cde-abb2-5a49dbde16c6" />

## 5.api ëª…ì„¸

|  accounts  | Method |       ë‚´ìš©        | ë¡œê·¸ì¸ ê¶Œí•œ | ì‘ì„±ì ê¶Œí•œ |
| :--------: | :----: | :---------------: | :---------: | :---------: |
| 'create/'  |  POST  |     íšŒì›ê°€ì…      |             |             |
|  'login/'  |  POST  | ë¡œê·¸ì¸(í† í° ë°œê¸‰) |             |             |
| 'refresh/' |  POST  | ì—‘ì„¸ìŠ¤í† í° ì¬ë°œê¸‰ |     âœ…      |             |
|     ''     |  GET   |    í”„ë¡œí•„ ì¡°íšŒ    |     âœ…      |     âœ…      |
|     ''     | PATCH  |    í”„ë¡œí•„ ìˆ˜ì •    |     âœ…      |     âœ…      |
|     ''     | DELETE |     íšŒì› íƒˆí‡´     |     âœ…      |     âœ…      |

<br>

|              chat               | Method |        ë‚´ìš©        | ë¡œê·¸ì¸ ê¶Œí•œ | ì‘ì„±ì ê¶Œí•œ |
| :-----------------------------: | :----: | :----------------: | :---------: | :---------: |
|          'roomcreate/'          |  POST  |    ì±„íŒ…ë°© ìƒì„±     |     âœ…      |     âœ…      |
|           'roomlist/'           |  GET   |   ë‚´ ì±„íŒ…ë°© ì¡°íšŒ   |     âœ…      |     âœ…      |
|       '<str:room_name>/'        |  GET   | ì±„íŒ…ë°© ë©”ì„¸ì§€ ì¡°íšŒ |     âœ…      |     âœ…      |
| 'roominvisible/<str:room_name>' |  GET   |    ì±„íŒ…ë°© ìˆ¨ê¹€     |     âœ…      |     âœ…      |

<br>

|     companion      | Method |      ë‚´ìš©      | ë¡œê·¸ì¸ ê¶Œí•œ | ì‘ì„±ì ê¶Œí•œ |
| :----------------: | :----: | :------------: | :---------: | :---------: |
|      'list/'       |  GET   | ë™í–‰ ëª©ë¡ì¡°íšŒ  |             |             |
|      'list/'       |  POST  |  ë™í–‰ ê¸€ ì‘ì„±  |     âœ…      |             |
|  'list/<int:pk>'   |  GET   |  ë™í–‰ ê¸€ ìƒì„¸  |             |             |
|  'list/<int:pk>'   |  PUT   |  ë™í–‰ ê¸€ ìˆ˜ì •  |     âœ…      |     âœ…      |
|  'list/<int:pk>'   | DELETE |  ë™í–‰ ê¸€ ì‚­ì œ  |     âœ…      |     âœ…      |
|     'comment/'     |  POST  | ë™í–‰ ëŒ“ê¸€ ì‘ì„± |     âœ…      |     âœ…      |
| 'comment/<int:pk>' | PATCH  | ë™í–‰ ëŒ“ê¸€ ìˆ˜ì • |     âœ…      |     âœ…      |
| 'comment/<int:pk>' | DELETE | ë™í–‰ ëŒ“ê¸€ ì‚­ì œ |     âœ…      |     âœ…      |

<br>

|         planner         | Method |      ë‚´ìš©      | ë¡œê·¸ì¸ ê¶Œí•œ | ì‘ì„±ì ê¶Œí•œ |
| :---------------------: | :----: | :------------: | :---------: | :---------: |
|     'api/planners/'     |  POST  |   ì¼ì • ìƒì„±    |     âœ…      |             |
|     'api/planners/'     |  GET   | ì¼ì • ëª©ë¡ ì¡°íšŒ |             |             |
| 'api/planners/<int:pk>' |  GET   | ì¼ì • ìƒì„¸ ì¡°íšŒ |             |             |
| 'api/planners/<int:pk>' | PATCH  |   ì¼ì • ìˆ˜ì •    |     âœ…      |     âœ…      |
| 'api/planners/<int:pk>' | DELETE |   ì¼ì • ì‚­ì œ    |     âœ…      |     âœ…      |

<br>

|             place             | Method |      ë‚´ìš©      | ë¡œê·¸ì¸ ê¶Œí•œ | ì‘ì„±ì ê¶Œí•œ |
| :---------------------------: | :----: | :------------: | :---------: | :---------: |
|         'api/places/'         |  POST  |   ì¥ì†Œ ìƒì„±    |     âœ…      |             |
|         'api/places/'         |  GET   | ì¥ì†Œ ëª©ë¡ ì¡°íšŒ |             |             |
| 'api/places/<int:comment_id>' |  GET   | ì¥ì†Œ ìƒì„¸ ì¡°íšŒ |             |             |
| 'api/places/<int:comment_id>' | PATCH  |   ì¥ì†Œ ìˆ˜ì •    |     âœ…      |     âœ…      |
| 'api/places/<int:comment_id>' | DELETE |   ì¥ì†Œ ì‚­ì œ    |     âœ…      |     âœ…      |

## 6.ë©”ì¸ê¸°ëŠ¥<br>

<img src=https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/e2adc15e-6487-48d0-bb8e-ae111cf0c250>íšŒì›ê°€ì… 

<img src=https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/73f3a8cb-96a9-45e2-bf69-10b0d281af2f>ì´ë©”ì¼ ì¸ì¦ ë° ë¡œê·¸ì¸

<img src=https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/13e4fd35-f3bf-443d-8999-16b05ff9c5c4>ë‚´ í”„ë¡œí•„


<div><img src=https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/0c9f5432-1d62-4cb9-bf11-61d814379d00></div>
í”„ë¡œí•„ ë³€ê²½




ë©”ì¸í˜ì´ì§€,
ë™í–‰, ì¼ì •

## 7.ì¶”ê°€ê¸°ëŠ¥<br>

í”„ë¡œí•„(ë³€ê²½), ë‚´ë™í–‰, ë‚´ì¼ì •
ì±„íŒ…

<img src=https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/e4098055-fd11-498d-8921-c1d214c10532>



<img src=https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/7e952857-1593-4a83-97d3-5894be168e62>
ì±„íŒ…í•˜ê¸°

<img src=https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/3d8ad921-b06c-4184-a400-8fb929b18d21>
ìŠ¤í¬ë¡¤ ì˜¬ë ¤ ë©”ì„¸ì§€ ë” ë¶ˆëŸ¬ì˜¤ê¸° ë° ë‚˜ê°€ê¸°

## 8.ê°œë°œì¤‘ ê²½í—˜í•œ ë¬¸ì œì ê³¼ í•´ê²°ë°©ë²•

### 8-1 ìœ ì € ì¸ì¦ êµ¬í˜„

ì´ì „ í”„ë¡œì íŠ¸ì—ì„œëŠ” ë‹¤ë¥¸ ë„ë©”ì¸ ê°„ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•œ ì¸ì¦ì´ ì‹¤íŒ¨í•œ ì ì´ ìˆìŠµë‹ˆë‹¤. ì¿ í‚¤ì˜ ê°’ì„ ì½ì„ ìˆ˜ ì—†ì–´, ë¡œê·¸ì¸ ì‹œ ì‘ë‹µì— í† í°ê°’ì„ ë³´ë‚´ì£¼ê³  ê·¸ê±¸ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ í›„ ë‹¤ìŒ ìš”ì²­ì‹œ ë³´ë‚´ëŠ” ë°©ì‹ì´ì˜€ìŠµë‹ˆë‹¤.

ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œëŠ” í•´ë‹¹ ë¬¸ì œë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ ë„ì „í–ˆê³ , ì´ë²ˆì—ëŠ” ì¿ í‚¤ì— í¬í•¨ëœ access_token ê°’ì„ í™œìš©í•˜ì—¬ ì‚¬ìš©ìë¥¼ ì¸ì¦í•˜ê³  ìˆìŠµë‹ˆë‹¤.

<img src=https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/df43f7dc-ba28-476b-94c7-297bc1f5d2a0>[ì§€ë‚œ í”„ë¡œì íŠ¸ ë„ë©”ì¸ ì°¨ì´]

<img src=https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/efb166d6-91b9-4b43-bdb6-653f2d4e149a>[í˜„ì¬ ë„ë©”ì¸]

ì‚¬ìš©ì ì¸ì¦ ì‹œ, ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ëŠ” restframework.authenticationëŒ€ì‹  ìƒˆë¡œìš´ ì¸ì¦ë°©ì‹ì„ êµ¬í˜„í•´ì•¼ í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ê¶Œí•œ(permission)ì„ ì¶”ê°€í•´ì•¼ í–ˆê¸° ë•Œë¬¸ì—, ì¿ í‚¤ì—ì„œ access í† í°ì„ ê²€ì¦í•˜ëŠ” JWTCookieAuthenticatedê¶Œí•œì„ ê¸°ë³¸ ì¸ì¦ë°©ì‹ìœ¼ë¡œ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤.

```python
class JWTCookieAuthenticated(BasePermission):
    def has_permission(self, request, view):
        cookie = request.COOKIES.get("access_token")
        if not cookie:
            return False
        try:
            access_token = AccessToken(cookie)
        except:
            return False

        return True
```


[ì¿ í‚¤ì—ì„œ access_tokenê°’ì„ ê°€ì ¸ì™€ ê¸°ê°„, ìœ íš¨ì„±ì„ ê²€ì¦í•˜ëŠ” permission]
<br>

ë•ë¶„ì— ì¿ í‚¤ì˜ ê°’ì„ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì½ì–´ë“¤ì´ëŠ” XSS(í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ…) ê³µê²© ë“±ì˜ ë³´ì•ˆ ì·¨ì•½ì ì„ ë°©ì§€í•˜ì—¬, ë³´ì•ˆì„±ì´ ê°•í™”ëœ ì‚¬ìš©ì ì¸ì¦ì´ ê°€ëŠ¥í•´ì¡ŒìŠµë‹ˆë‹¤.

### 8-2 ì±„íŒ… êµ¬í˜„ì¤‘ ë¬¸ì œì 

ê°™ì´ ì—¬í–‰ê°ˆ ë™ë£Œì„ ëª¨ì§‘í•˜ë©° ì„œë¡œ ì±„íŒ…ì„ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê³ ì í•˜ì˜€ìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°„ ì±„íŒ…ì„ í•˜ëŠ”ë° í•„ìš”í•œ ì¡°ê±´ì„ ë‹¤ìŒê³¼ ê°™ì´ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.

-   ì±„íŒ…ë°©ì„ ìƒì„±í•˜ê³ , ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆì–´ì•¼í•œë‹¤.
-   ì±„íŒ…ë°©ì˜ ë©”ì„¸ì§€ë¥¼ ìƒì„±í•˜ê³  ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆì–´ì•¼í•œë‹¤.
-   ë©”ì„¸ì§€ëŠ” DBì— ì €ì¥ë˜ì–´ ë‹¤ìŒ ì±„íŒ…ì„ ì´ì–´ê°ˆ ë•Œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆì–´ì•¼í•œë‹¤.
-   1:1 ì±„íŒ…ë°©ì—ëŠ” ë³´ë‚¸ ì‚¬ëŒê³¼ ë°›ëŠ”ì‚¬ëŒë§Œì´ ë©”ì„¸ì§€ë¥¼ ì½ì„ ìˆ˜ ìˆë‹¤.
-   ë‘˜ ì¤‘ í•œëª…ì´ ë‚˜ê°„ë‹¤ë©´ ë‚¨ëŠ” ì‚¬ëŒë§Œ ê¸°ì¡´ ë©”ì„¸ì§€ë¥¼ í™•ì¸ê°€ëŠ¥.
-   ë‚¨ì€ì‚¬ëŒì´ ë©”ì„¸ì§€ë¥¼ ë³´ëƒˆë‹¤ë©´ ë‚˜ê°„ì‚¬ëŒì€ ë‹¤ì‹œ ê¸°ì¡´ ë©”ì„¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆì–´ì•¼í•œë‹¤.

ì¡°ê±´ì„ ë§Œì¡±í•˜ê¸° ìœ„í•œ ì´ˆê¸°ëª¨ë¸ë§ì„ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

<details>
  <summary>Room</summary>

```python
class Room(TimestampedModel):
    member = models.ManyToManyField(User, related_name="member")
    room_name = models.CharField(max_length=50)
    invisible = models.ManyToManyField(User, "room_invisible")
    lastest_text = models.TextField("ë§ˆì§€ë§‰ ëŒ€í™”")
```

-   memberì—ì„œ ì±„íŒ…ë°©ì— ì–´ëŠ ìœ ì €ê°€ ìˆëŠ”ì§€ ì¤‘ê³„í…Œì´ë¸”ì„ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤.
-   invisibleì— í•´ë‹¹í•˜ëŠ” userê°€ ì¶”ê°€ë˜ë©´ ë°© ëª©ë¡ì—ì„œ ë³´ì´ì§€ ì•Šê²Œ ë©ë‹ˆë‹¤.
-   ì±„íŒ…ë°©ì˜ ë§ˆì§€ë§‰ ë©”ì„¸ì§€ë¥¼ ì €ì¥í•˜ì—¬ ë°© ëª©ë¡ì„ ì¡°íšŒí•  ë•Œ ê°™ì´ ë³´ì´ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ memberì™€ invisibleì˜ ì¤‘ê³„í…Œì´ë¸”ì„ ë§Œë“œëŠ” ê³¼ì •ì´ ì¤‘ë³µë˜ì—ˆê³ , ì±„íŒ…ë°©ì— ëª¨ë“  ìœ ì €ê°€ ë‚˜ê°ˆ ì‹œ
ëŒ€í™” ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ë°©ë²•ì´ ì—†ëŠ” ë¬¸ì œê°€ ìƒê²¨ ëª¨ë¸ì„ ìˆ˜ì •í•˜ì˜€ìŠµë‹ˆë‹¤.

```python
class Rooms(TimestampedModel):
    room_name = models.CharField(max_length=50)
    lastest_text = models.TextField("ë§ˆì§€ë§‰ ëŒ€í™”")


class Room_members(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name="member")
    room = models.ForeignKey(Rooms, on_delete=models.CASCADE, related_name="visibility")
    is_visibled = models.BooleanField(default=True)

```

ëª¨ë¸ì„ ë‚˜ëˆ  ì‚¬ìš©ìì™€ ì±„íŒ…ë°© ìˆ¨ê¹€ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” ëª¨ë¸ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ì¤‘ê³„í…Œì´ë¸”ì´ ì¤‘ë³µë˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ì˜€ê³ , ì±„íŒ…ë°©ì„ ìˆ¨ê²¨ë„ ë©”ì„¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆê²Œë˜ì—ˆìŠµë‹ˆë‹¤.

</details>

#### ë¹„ë™ê¸° ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìœ ì €ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œ

<details>
  <summary> error</summary>

```
asyncio.py", line 24, in inner
raise SynchronousOnlyOperation(message)
django.core.exceptions.SynchronousOnlyOperation: You cannot call this from an async context - use a thread or sync_to_async.
```

</details>
í† í°ì—ìˆëŠ” ìœ ì €ì˜ pkê°’ì„ ì´ìš©í•˜ì—¬ ì‚¬ìš©ìë¥¼ ê²€ì¦í•˜ë ¤ê³  í•˜ì˜€ëŠ”ë° ë¹„ë™ê¸°ì ì¸ í•¨ìˆ˜ì˜ ì‹¤í–‰ê³¼ì •ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼í•˜ë ¤ê³ í•˜ë‹ˆ í•´ë‹¹ ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.

```python
class ChatConsumer(AsyncWebsocketConsumer):
    async def connect(self):
       ...
       try:
            token = self.scope["cookies"]["access_token"]
            user_id = AccessToken(token)["user_id"]
            user = await User.objects.get(pk=user_id)
            print(user)
        ...
```

ì›ì¸ì€ ì¥ê³ ì˜ ORMì€ ê¸°ë³¸ì ìœ¼ë¡œ ë™ê¸°ì ì¸ í™˜ê²½ì—ì„œ ì‚¬ìš©ë˜ë„ë¡ ì„¤ê³„ë˜ì—ˆê¸° ë•Œë¬¸ì—, ìœ„ì™€ ê°™ì€ ë¹„ë™ê¸° í•¨ìˆ˜ ì•ˆì—ì„œ ë™ê¸°ì ì¸ ORMë©”ì„œë“œë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì˜€ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ë¹„ë™ê¸°ì ì¸ í™˜ê²½ì—ì„œ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ëŠ” channels.dbëª¨ë“ˆì˜ database_sync_to_asyncë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•˜ì˜€ìŠµë‹ˆë‹¤.

```python
class ChatConsumer(AsyncWebsocketConsumer):
    async def connect(self):
        user = await get_user_from_cookie(self)
        room_name = self.scope["url_route"]["kwargs"]["room_name"]
        room = await get_room(room_name)
        ...
```

<details>
  <summary>get_user_from_cookie</summary>

```python
async def get_user_from_cookie(self):
    try:
        token = self.scope["cookies"]["access_token"]
        user_id = AccessToken(token)["user_id"]
        user = await get_user(user_id)
        return user

    except TokenError:
        await self.close()
        return Response({"error": "í† í°ë§Œë£Œ"}, status=401)
```

ìŠ¤ì½”í”„ì—ì„œ ì¿ í‚¤ì˜ ì—‘ì„¸ìŠ¤í† í° ê°’ì—ì„œ user_idë¥¼ ê°€ì ¸ì™€ get_user()í˜¸ì¶œ

</details>
<details>
<summary>get_user</summary>

```python
@database_sync_to_async
def get_user(user_id):
    return User.objects.get(pk=user_id)
```

</details>

#### ì±„íŒ…ë°©ì„ ìˆ¨ê¸°ë©´ ìƒëŒ€ë°©ë„ ì±„íŒ…ë°©ì´ ë³´ì´ì§€ ì•ŠëŠ” ë¬¸ì œ

```python
class RoomListAPIView(generics.ListAPIView):
    serializer_class = RoomSerializer

    def get_queryset(self):
        user_id = get_user_id(self.request)
        queryset = (
            Rooms.objects.filter(visibility__user=user_id)
            .exclude(visibility__is_visibled=False)
            .order_by("-updated_at")
        )
        return queryset
```

```python

class Rooms(TimestampedModel):
    room_name = models.CharField(max_length=50)
    lastest_text = models.TextField("ë§ˆì§€ë§‰ ëŒ€í™”")


class Room_members(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name="member")
    room = models.ForeignKey(Rooms, on_delete=models.CASCADE, related_name="visibility")
    is_visibled = models.BooleanField(default=True)
```


ì´ˆê¸° ì±„íŒ…ë°©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë·°ë¥¼ ìœ„ì™€ê°™ì´ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì‚¬ìš©ìì˜ idê°€ ìˆëŠ” Roomsì¤‘ is_visibled=Falseê²ƒì€ ì œì™¸í•˜ê³  ë¦¬ìŠ¤íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ì±„íŒ…ë°©ì—ì„œ í•œ ìœ ì €ê°€ ì±„íŒ…ë°©ì„ ì‚­ì œí•˜ë©´ ë‹¤ë¥¸ ëª¨ë“  ìœ ì €ë“¤ì€ í•´ë‹¹ì±„íŒ…ë°©ì˜ ëª©ë¡ì„ ì¡°íšŒí•  ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ìš°ì„  ORMì—ì„œ ì¿¼ë¦¬ë¥¼ ì–´ë–»ê²Œ ìƒì„±í•˜ëŠ”ì§€ ì‚´í´ë´¤ìŠµë‹ˆë‹¤.

<details>
<summary>query</summary>
SELECT "chat_rooms"."id", "chat_rooms"."created_at", "chat_rooms"."updated_at", "chat_rooms"."room_name", "chat_rooms"."lastest_text" FROM "chat_rooms" INNER JOIN "chat_room_members" ON ("chat_rooms"."id" = "chat_room_members"."room_id") WHERE ("chat_room_members"."user_id" = 3 AND NOT (EXISTS(SELECT 1 AS "a" FROM "chat_room_members" U1 WHERE (NOT U1."is_visibled" AND U1."room_id" = ("chat_rooms"."id")) LIMIT 1))) ORDER BY "chat_rooms"."updated_at" DESC
</details>

EXISTS... Roomsì— is_visibledê°€ Falseì¸ ê²½ìš°ê°€ í•˜ë‚˜ë¼ë„ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ìˆìœ¼ë©´ ì¡°íšŒê°€ ë˜ì§€ ì•ŠëŠ” ë¬¸ì œì˜€ê³  ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤.

```python
class RoomListAPIView(generics.ListAPIView):
    serializer_class = RoomSerializer

    def get_queryset(self):
        user_id = get_user_id(self.request)
        room_ids = Room_members.objects.filter(
            user=user_id, is_visibled=True
        ).values_list("room", flat=True)
        queryset = Rooms.objects.filter(id__in=room_ids)
        return queryset
```

<details>
<summary>query</summary>

1ë²ˆì¿¼ë¦¬
SELECT "chat_room_members"."room_id" FROM "chat_room_members" WHERE ("chat_room_members"."is_visibled" AND "chat_room_members"."user_id" = 1)

2ë²ˆì¿¼ë¦¬
SELECT "chat_rooms"."id", "chat_rooms"."created_at", "chat_rooms"."updated_at", "chat_rooms"."room_name", "chat_rooms"."lastest_text" FROM "chat_rooms" WHERE "chat_rooms"."id" IN (SELECT U0."room_id" FROM "chat_room_members" U0 WHERE (U0."is_visibled" AND U0."user_id" = 1)) ORDER BY "chat_rooms"."created_at" DESC, "chat_rooms"."updated_at" DESC

</details>

[ìµœì¢… ì±„íŒ…]
<img src=https://github.com/Infinity-Scroll/Infinity_Travel_BE/assets/138690980/e4098055-fd11-498d-8921-c1d214c10532>



## 9.í”„ë¡œì íŠ¸ í›„ê¸°(ë°°ìš´ì  & ëŠë‚€ì )

### ê¹€ì°½í™˜

ëª¨ë‘ í”„ë¡œì íŠ¸ ê¸°ê°„ë™ì•ˆ ê³ ìƒí•˜ì…¨ìŠµë‹ˆë‹¤. ì²« íŒ€ í”„ë¡œì íŠ¸ì—ì„œ íŒ€ì¥ ì—­í• ì„ ë§¡ì•„ íŒ€ì„ ì´ëŒì—ˆì§€ë§Œ ë¶€ì¡±í•œ ëª¨ìŠµë§Œ íŒ€ì›ë¶„ë“¤ì—ê²Œ ë³´ì—¬ì¤€ê²ƒ ê°™ì•„ ì£„ì†¡í•©ë‹ˆë‹¤. ê·¸ë˜ë„ ëê¹Œì§€ ë”°ë¼ì™€ì£¼ì‹œê³  ë…¸ë ¥í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. íŒ€ìœ¼ë¡œì¨ í˜‘ì—…ì„í†µí•´ í• ìˆ˜ìˆëŠ” ê²½í—˜ë“¤ì„ ì–»ê²Œë˜ì—ˆìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©° ì¬ë¯¸ìˆëŠ” ê²½í—˜, ì•„ì‰¬ìš´ ê²½í—˜ë„ ìˆì—ˆê³  ì €ì—ê²Œ í° ìê·¹ì´ ë˜ì–´ ì„±ì¥í•˜ëŠ” ê³„ê¸°ê°€ ëœê²ƒê°™ì•„ ë§Œì¡±í•˜ê³  ìˆìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ ê¸°ê°„ë™ì•ˆ ì¢‹ì€ ê²½í—˜ì„ ì–»ê²Œ í•´ì£¼ì‹  ì •ì‹ë‹˜,ì£¼ìš©ë‹˜ì—ê²Œ ê°ì‚¬ ì¸ì‚¬ë¥¼ ë“œë¦½ë‹ˆë‹¤. ì•ìœ¼ë¡œë„ ì´ ê²½í—˜ì„ ê¸°ì–µí•˜ë©° ë” ë…¸ë ¥í•˜ëŠ” ê°œë°œìê°€ ë˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

### ë‚¨ì •ì‹

í”„ë¡œì íŠ¸ì˜ ì „ì²´ ìŠ¤í™ì„ íŒŒì•…í•˜ì§€ ëª»í•´ í•„ìš”í•œ ì—…ë¬´ ëª©ë¡, ì—…ë¬´ ë¶„ë°°ì— ë¬¸ì œë¥¼ ê²ªì—ˆìŠµë‹ˆë‹¤
ë³¸ì¸ì˜ ì—­ëŸ‰ì´ë‚˜ í–‰ë™ë ¥ì— ëŒ€í•´ ì •ëŸ‰ì ìœ¼ë¡œ ì•Œ ìˆ˜ ìˆëŠ” ê¸°íšŒì˜€ê³ , ì—¬ëŸ¬ ë²ˆì˜ í”„ë¡œì íŠ¸ ê²½í—˜ì„ í†µí•´ êµ¬ì²´í™” í•  ìˆ˜ ìˆì—ˆë‹¤
ê¸°ì¡´ ìˆë˜ í”„ë¡œì íŠ¸ë¥¼ ì°¸ê³  í•¨ìœ¼ë¡œì„œ í˜„ì¬ ì„œë¹„ìŠ¤ ë˜ëŠ” í”„ë¡œì íŠ¸ë“¤ì˜ ìŠ¤í™ì„ í™•ì¸í•˜ëŠ” ê²½í—˜ì„ í–ˆë‹¤

### ì‹¬ì£¼ìš©

ì²˜ìŒ ì ‘í•´ë³¸ íŒ€ í”„ë¡œì íŠ¸ì˜ ì§„í–‰ ìƒí™© ë° ê³¼ì •ì— ëŒ€í•´ ê¸°ëŒ€ì— ë¶€ì‘í•˜ëŠ” ë¶€ë¶„ê³¼ ê¸°ëŒ€ì™€ ì–´ê¸‹ë‚˜ëŠ” ë¶€ë¶„ ë“±ì— í™•ì‹¤í•œ ê²½í—˜ì„ í•˜ê²Œ ë˜ì–´ ê¸°ì©ë‹ˆë‹¤.
í”„ë¡œì íŠ¸ì˜ ê²½í—˜ìœ¼ë¡œ ë¬¸ì œí•´ê²°ì— ëŒ€í•œ ê³ ë¯¼í•  ì‹œê°„ì´ ë§ì•˜ìœ¼ë©°, ì´ì— ëŒ€í•´ ì¡°ê¸ˆì”© ê³µë¶€í•˜ëŠ” ëŠë‚Œì„ ë°›ì•˜ìŠµë‹ˆë‹¤.
ìŠ¤ìŠ¤ë¡œì˜ ê°œë°œ ì†ë„ì— ëŒ€í•´ ì•Œì•„ë³¼ ìˆ˜ ìˆì—ˆìœ¼ë©°, ìê°€ë°œì „ì„ ìœ„í•œ ë°©í–¥ì„±ì„ ì°¾ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

